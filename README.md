# Лабораторная работа 1

Используя сведения из системных каталогов, получить информацию обо всех столбцах заданной таблицы, находящейся в схеме заданного пользователя. Полученную информацию представить в следующем формате:

```
Пользователь: Ivan Ivanov (s100000)
Таблица: н_характеристики_видов_работ  

 No. Имя столбца   Атрибуты
 --- -----------   ------------------------------------------------------
   1 свр_ид        Type   : NUMBER(9)
                   Constr : "хвр_свр_fk" References н_свойства_вр(ид)
  
   2 вр_ид         Type   : NUMBER(9)
                   Constr : "хвр_вр_fk"  References н_виды_работ(ид)
   
   2 кто_создал    Type   : Date
   3 когда_создал  Type   : Date
   4 кто_изменил   Type   : Date
   5 когда_изменил Type   : Date
```
Программу оформить в виде процедуры.

# Лабораторная работа 2

Цель работы - на выделенном узле создать и сконфигурировать новый кластер БД Postgres, саму БД, табличные пространства и новую роль, а также произвести наполнение базы в соответствии с заданием. Отчёт по работе должен содержать все команды по настройке, скрипты, а также измененные строки конфигурационных файлов.

## Этап 1. Инициализация кластера БД
- Директория кластера: `$HOME/jcf50`
- Кодировка: `UTF8`
- Локаль: `английская`
- Параметры инициализации задать через `переменные окружения`

## Этап 2. Конфигурация и запуск сервера БД
- Способ подключения: сокет `TCP/IP`, принимать подключения к любому IP-адресу узла
- Номер порта: `9512`
- Остальные способы подключений запретить.
- Способ аутентификации клиентов: по паролю `MD5`
- Настроить следующие параметры сервера БД:
  + max_connections
  + shared_buffers 
  + temp_buffers
  + work_mem
  + checkpoint_timeout
  + effective_cache_size
  + fsync
  + commit_delay
- Параметры должны быть подобраны в соответствии с аппаратной конфигурацией:
оперативная память `20ГБ`, хранение на твердотельном накопителе (SSD).
- Директория WAL файлов: $PGDATA/pg_wal
- Формат лог-файлов: `.csv`
- Уровень сообщений лога: `NOTICE`
- Дополнительно логировать: завершение сессий и продолжительность выполнения команд

## Этап 3. Дополнительные табличные пространства и наполнение базы
- Создать новое табличное пространство для индексов: `$HOME/zgf65`
- На основе template1 создать новую базу: `lazybluearmy`
- Создать новую роль, предоставить необходимые права, разрешить подключение к базе.
- От имени новой роли (не администратора) произвести наполнение ВСЕХ созданных баз тестовыми наборами данных. ВСЕ табличные пространства должны использоваться по назначению.
- Вывести список всех табличных пространств кластера и содержащиеся в них объекты.

# Лабораторная работа 3
## Вариант 4
Лабораторная работа включает настройку резервного копирования данных с основного узла на резервный, а также несколько сценариев восстановления. Узел из предыдущей лабораторной работы используется в качестве основного; новый узел используется в качестве резервного. В сценариях восстановления необходимо использовать копию данных, полученную на первом этапе данной лабораторной работы.

1. Резервное копирование

- Настроить резервное копирование с основного узла на резервный следующим образом:

  + Периодические обособленные (standalone) полные копии.

  + Полное резервное копирование (pg_basebackup) по расписанию (cron) два раза в сутки. Необходимые файлы WAL должны быть в составе полной копии, отдельно их не архивировать. Срок хранения копий на основной системе - 1 неделя, на резервной - 1 месяц. По истечении срока хранения, старые архивы должны автоматически уничтожаться.

- Подсчитать, каков будет объем резервных копий спустя месяц работы системы, исходя из следующих условий:

  + Средний объем измененных данных за сутки: ~300 МБ.

- Проанализировать результаты.

 
2. Потеря основного узла

- Этот сценарий подразумевает полную недоступность основного узла. Необходимо восстановить работу СУБД на резервном узле, продемонстрировать успешный запуск СУБД и доступность данных.

 
3. Повреждение файлов БД

- Этот сценарий подразумевает потерю данных (например, в результате сбоя диска или файловой системы) при сохранении доступности основного узла. Необходимо выполнить полное восстановление данных из резервной копии и перезапустить СУБД на основном узле.

- Ход работы:

  + Симулировать сбой:

    * удалить с диска директорию конфигурационных файлов СУБД со всем содержимым.

  + Проверить работу СУБД, доступность данных, перезапустить СУБД, проанализировать результаты.

  + Выполнить восстановление данных из резервной копии, учитывая следующее условие:

    * Исходное расположение дополнительных табличных пространств недоступно - разместить в другой директории и скорректировать конфигурацию.

  + Запустить СУБД, проверить работу и доступность данных, проанализировать результаты.


4. Логическое повреждение данных

- Этот сценарий подразумевает частичную потерю данных (в результате нежелательной или ошибочной операции) при сохранении доступности основного узла. Необходимо выполнить восстановление данных на основном узле следующим способом:

- Восстановление с использованием архивных WAL файлов.(СУБД должна работать в режиме архивирования WAL, потребуется задать параметры восстановления).

- Ход работы:

  + В каждую таблицу базы добавить 2-3 новые строки, зафиксировать результат.

  + Зафиксировать время и симулировать ошибку:

    * В любой таблице с внешними ключами изменить внешние ключи случайным образом (INSERT, UPDATE)

  + Продемонстрировать результат.

  + Выполнить восстановление данных указанным способом.

  + Продемонстрировать и проанализировать результат.
